require("newrelic");const express=require("express"),app=express(),nodemailer=require("nodemailer"),path=require("path"),bodyParser=require("body-parser"),mongoose=require("mongoose"),http=require("http");setInterval(()=>{http.get("http://pako-web-developer.herokuapp.com")},36e5),mongoose.Promise=global.Promise,mongoose.connect("mongodb://varp:stefasquale2306@ds217092.mlab.com:17092/website"),app.use(bodyParser.urlencoded({extended:!0})),app.use(express.static("public")),app.use("/css",express.static(__dirname+"/css")),app.use("/js",express.static(__dirname+"/js")),app.use("/img",express.static(__dirname+"/img")),app.use("/files",express.static(__dirname+"/files"));const port=8081,GMAIL_USER="pasquale.delucia96@gmail.com",GMAIL_PASS="stefasquale2306",emailSubSchema=new mongoose.Schema({email:String});var EmailSub=mongoose.model("User",emailSubSchema);app.get("/",(req,res)=>{res.sendFile("index.html",{root:path.join(__dirname,"./public/")})}),app.post("/subscribe",(req,res)=>{EmailSub.findOne({email:req.body.emailSubscribe}).then(data=>{if(data)res.sendFile("subscribed.html",{root:path.join(__dirname,"./public/")});else{const person=new EmailSub;person.email=req.body.emailSubscribe,person.save().then(()=>{res.sendFile("subscribed.html",{root:path.join(__dirname,"./public/")})}).catch(()=>{res.sendFile("500.html",{root:path.join(__dirname,"./public/")})})}}).catch(()=>{res.sendFile("500.html",{root:path.join(__dirname,"./public/")})})}),app.post("/contact",(req,res)=>{const transporter=nodemailer.createTransport({service:"gmail",auth:{user:GMAIL_USER,pass:GMAIL_PASS}}),mailOpts={from:req.body.email,to:GMAIL_USER,subject:"New message from website"+req.body.subject,text:`${req.body.name} (${req.body.email}) says: ${req.body.message}`};transporter.sendMail(mailOpts,(error,response)=>{console.log("email send error: "+JSON.stringify(error)),error?res.sendFile("404.html",{root:path.join(__dirname,"./public/")}):res.sendFile("success.html",{root:path.join(__dirname,"./public/")})})}),app.listen(process.env.PORT||8081);